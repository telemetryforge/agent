# Taken from https://github.com/fluent/fluent-bit/issues/11068
service:
  flush: 1
  log_level: info
  http_server: on
  storage.metrics: on
  health_check: on

  # Ensure you can write to this as the current user - usually requires a security context
  storage.path: /var/log/fluent-bit/storage
pipeline:
  inputs:
    - name: systemd
      alias: input_systemd_k8s
      tag: host.*
      systemd_filter: _SYSTEMD_UNIT=kubelet.service
      read_from_tail: true
      lowercase: on

      # Triggers segmentation fault: https://github.com/fluent/fluent-bit/issues/11068
      # threaded: true

      db: /var/log/fluent-bit/storage/systemd.db
      db.sync: Normal
      Mem_Buf_Limit: 100MB
      storage.type: filesystem
      storage.pause_on_chunks_overlimit: on

  outputs:
      - name: stdout
        alias: output_stdout_all
        match: "*"
